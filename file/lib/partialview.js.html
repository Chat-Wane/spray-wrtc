<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/partialview.js | spray-wrtc</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Adaptive random peer-sampling protocol running on top of WebRTC"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="spray-wrtc"><meta property="twitter:description" content="Adaptive random peer-sampling protocol running on top of WebRTC"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/ran3d/spray-wrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/partialview.js~PartialView.html">PartialView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/spray.js~Spray.html">Spray</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#exceptions">exceptions</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/exceptions/exemptyview.js~ExEmptyView.html">ExEmptyView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/exceptions/exjoin.js~ExJoin.html">ExJoin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/exceptions/exmessage.js~ExMessage.html">ExMessage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/exceptions/expeernotfound.js~ExPeerNotFound.html">ExPeerNotFound</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#messages">messages</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/messages/mexchange.js~MExchange.html">MExchange</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/messages/mjoin.js~MJoin.html">MJoin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/messages/mleave.js~MLeave.html">MLeave</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/partialview.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

const ExPeerNotFound = require(&apos;./exceptions/expeernotfound.js&apos;);

/**
 * Structure containing the neighborhood of a peer.
 * Map of {idPeer =&gt; [age_1, age_2.. age_k]} where age_1 &lt;= age_2 &lt;= .. &lt;= age_k
 */
class PartialView extends Map {
    constructor () {
        super();
    };
    
    /**
     * Get the oldest peer in the partial view.
     * @returns {string} The oldest peer in the array.
     */
    get oldest () {
        if (this.size &lt;= 0) { throw new ExPeerNotFound(&apos;oldest&apos;); };
        let oldestPeer = null;
        let oldestAge = 0;
        this.forEach( (ages, peerId) =&gt; {
            if (oldestAge &lt;= ages[ages.length - 1]) {
                oldestPeer = peerId;
                oldestAge = ages[ages.length - 1];
            };
        });
        return oldestPeer;
    };


    /**
     * Increment the age of the whole partial view
     */
    increment () {
        this.forEach( (ages, peerId) =&gt; {
            this.set(peerId, ages.map( (age) =&gt; {return age+1;} ));
        });
    };

    /**
     * Add the peer to the partial view with an age of 0.
     * @param {string} peerId The identifier of the peer added to the partial
     * view.
     */
    add (peerId) {
        (!this.has(peerId)) &amp;&amp; this.set(peerId, new Array());        
        this.get(peerId).unshift(0); // add 0 in front of the array
    };

    /**
     * Remove the newest entry of the peer from the partial view.
     * @param {string} peerId The identifier of the peer to remove from the 
     * partial view. 
     */
    removeYoungest (peerId) {
        if (!this.has(peerId)) {
            throw new ExPeerNotFound(&apos;removeYoungest&apos;, peerId);
        };
        this.get(peerId).shift();
        (this.get(peerId).length === 0) &amp;&amp; this.delete(peerId);
    };

    /**
     * Remove the oldest entry of the peer from the partial view.
     * @param {string} peerId The identifier of the peer to remove from the 
     * partial view. 
     */
    removeOldest (peerId) {
        if (!this.has(peerId)) {
            throw new ExPeerNotFound(&apos;removeOldest&apos;, peerId);
        };
        this.get(peerId).pop();
        (this.get(peerId).length === 0) &amp;&amp; this.delete(peerId);
    };

    
    /**
     * Remove all entries of the peer from the partial view.
     * @param {string} peerId The identifier of the peer to remove from the 
     * partial view.
     * @returns {number} The number of occurrences of peerId removed.
     */
    removeAll (peerId) {
        if (!this.has(peerId)) {
            throw new ExPeerNotFound(&apos;removeAll&apos;, peerId);
        };
        const occ = this.get(peerId).length;
        this.delete(peerId);
        return occ;
    };
       

    /**
     * Get the least frequent peer. If multiple peers have the same number of
     * occurrences, it chooses one among them at random.
     * @returns {string} The identifier of a least frequent peer.
     */
    get leastFrequent () {
        let leastFrequent = [];
        let frequency = Infinity;
        this.forEach( (ages, peerId) =&gt; {
            if (ages.length &lt; frequency){
                leastFrequent = [];
                frequency = ages.length;
            };
            (ages.length === frequency) &amp;&amp; leastFrequent.push(peerId);
        });
        return leastFrequent[Math.floor(Math.random() * leastFrequent.length)];
    };    
}


module.exports = PartialView;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
